{% extends "base.htm" %}
{% block title %}My Bids{% endblock %}

{% block content %}
<script>
    function openDialog(auctionId,auctionText) {
    var dialogTitle = document.getElementById('dialogTitle');
    dialogTitle.innerText = auctionText;
    dialogTitle.style.cursor = 'pointer';
    dialogTitle.addEventListener('click', function () {
        // Redirect to another page when the title is clicked
        window.location.href = `/auctionDetails/${auctionId}`; // Replace with the actual URL you want to redirect to
    });
    // Get the table body in the dialog
    var dialogTableBody = document.getElementById('dialogTable').getElementsByTagName('tbody')[0];
    
    // Clear existing rows in the dialog table
    dialogTableBody.innerHTML = '';
    
    // Fetch bid data using auctionId
    fetch(`/myBids/${auctionId}`)
        .then(response => response.json())
        .then(data => {
            data.forEach(function(bid) {

            var row = dialogTableBody.insertRow();
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);

            cell1.innerHTML = bid.Bid_amt;
            cell2.innerHTML = bid.Bid_time;
        });

        document.getElementById('bidsDialog').showModal();
    })
    .catch(error => console.error('Error fetching bid data:', error));
}
    
function closeDialog() {
    document.getElementById('bidsDialog').close();
}

</script>

    <h1>My Bids</h1>
    
    {% if myBids %}
        <table border="1" id="bidsTable">
            <thead>
                <tr>
                    <th>Auction ID</th>
                    <th>Auction Text</th>
                    <th>Latest Bid Time</th>
                    <th>No. of Bids</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for bid in myBids %}
                    <tr>
                        <td>{{ bid.Auction_id }}</td>
                        <td>{{ bid.Auction_text }}</td>
                        <td>{{ bid.latest_bid_time }}</td>
                        <td>{{ bid.no_of_bids }}</td>
                        <td>
                            <button onclick="openDialog('{{ bid.Auction_id }}', '{{ bid.Auction_text }}')">View Bids</button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Login to see your Bids</p>
        <a href="/login">
            <button>Login</button>
    {% endif %}
    <!-- Dialog box -->
    <dialog id="bidsDialog">
        <h2 id="dialogTitle">Bids for Auction</h2>
        <table border="1" id="dialogTable">
            <thead>
                <tr>
                    <th>Amount</th>
                    <th>Time</th>
                    <!-- Add additional columns as needed -->
                </tr>
            </thead>
            <tbody>
                <!-- Data will be dynamically added here -->
            </tbody>
        </table>
        <button onclick="closeDialog()">Close</button>
    </dialog>
{% endblock %}